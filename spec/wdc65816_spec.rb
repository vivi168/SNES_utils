require 'spec_helper'
require 'snes_utils'

describe SnesUtils::MiniAssembler do
let(:mini_asm) { SnesUtils::MiniAssembler.new }
  describe 'when assembling' do
  end

  describe 'when disassembling' do
    subject { mini_asm.disassemble_range(0, count) }

    let(:memory) do
      ["00", "11", "01", "11", "02", "11", "03", "11", "04", "11", "05", "11", "06", "11", "07", "11",
        "08", "09", "11", "0a", "0b", "0c", "22", "11", "0d", "22", "11", "0e", "22", "11", "0f", "33",
        "22", "11", "10", "11", "11", "11", "12", "11", "13", "11", "14", "11", "15", "11", "16", "11",
        "17", "11", "18", "19", "22", "11", "1a", "1b", "1c", "22", "11", "1d", "22", "11", "1e", "22",
        "11", "1f", "33", "22", "11", "20", "22", "11", "21", "11", "22", "33", "22", "11", "23", "11",
        "24", "11", "25", "11", "26", "11", "27", "11", "28", "29", "11", "2a", "2b", "2c", "22", "11",
        "2d", "22", "11", "2e", "22", "11", "2f", "33", "22", "11", "30", "11", "31", "11", "32", "11",
        "33", "11", "34", "11", "35", "11", "36", "11", "37", "11", "38", "39", "22", "11", "3a", "3b",
        "3c", "22", "11", "3d", "22", "11", "3e", "22", "11", "3f", "33", "22", "11", "40", "41", "11",
        "42", "11", "43", "11", "44", "22", "11", "45", "11", "46", "11", "47", "11", "48", "49", "11",
        "4a", "4b", "4c", "22", "11", "4d", "22", "11", "4e", "22", "11", "4f", "33", "22", "11", "50",
        "11", "51", "11", "52", "11", "53", "11", "54", "22", "11", "55", "11", "56", "11", "57", "11",
        "58", "59", "22", "11", "5a", "5b", "5c", "33", "22", "11", "5d", "22", "11", "5e", "22", "11",
        "5f", "33", "22", "11", "60", "61", "11", "62", "22", "11", "63", "11", "64", "11", "65", "11",
        "66", "11", "67", "11", "68", "69", "11", "6a", "6b", "6c", "22", "11", "6d", "22", "11", "6e",
        "22", "11", "6f", "33", "22", "11", "70", "11", "71", "11", "72", "11", "73", "11", "74", "11",
        "75", "11", "76", "11", "77", "11", "78", "79", "22", "11", "7a", "7b", "7c", "22", "11", "7d",
        "22", "11", "7e", "22", "11", "7f", "33", "22", "11", "80", "11", "81", "11", "82", "22", "11",
        "83", "11", "84", "11", "85", "11", "86", "11", "87", "11", "88", "89", "11", "8a", "8b", "8c",
        "22", "11", "8d", "22", "11", "8e", "22", "11", "8f", "33", "22", "11", "90", "11", "91", "11",
        "92", "11", "93", "11", "94", "11", "95", "11", "96", "11", "97", "11", "98", "99", "22", "11",
        "9a", "9b", "9c", "22", "11", "9d", "22", "11", "9e", "22", "11", "9f", "33", "22", "11", "a0",
        "11", "a1", "11", "a2", "11", "a3", "11", "a4", "11", "a5", "11", "a6", "11", "a7", "11", "a8",
        "a9", "11", "aa", "ab", "ac", "22", "11", "ad", "22", "11", "ae", "22", "11", "af", "33", "22",
        "11", "b0", "11", "b1", "11", "b2", "11", "b3", "11", "b4", "11", "b5", "11", "b6", "11", "b7",
        "11", "b8", "b9", "22", "11", "ba", "bb", "bc", "22", "11", "bd", "22", "11", "be", "22", "11",
        "bf", "33", "22", "11", "c0", "11", "c1", "11", "c2", "00", "c3", "11", "c4", "11", "c5", "11",
        "c6", "11", "c7", "11", "c8", "c9", "11", "ca", "cb", "cc", "22", "11", "cd", "22", "11", "ce",
        "22", "11", "cf", "33", "22", "11", "d0", "11", "d1", "11", "d2", "11", "d3", "11", "d4", "11",
        "d5", "11", "d6", "11", "d7", "11", "d8", "d9", "22", "11", "da", "db", "dc", "22", "11", "dd",
        "22", "11", "de", "22", "11", "df", "33", "22", "11", "e0", "11", "e1", "11", "e2", "00", "e3",
        "11", "e4", "11", "e5", "11", "e6", "11", "e7", "11", "e8", "e9", "11", "ea", "eb", "ec", "22",
        "11", "ed", "22", "11", "ee", "22", "11", "ef", "33", "22", "11", "f0", "11", "f1", "11", "f2",
        "11", "f3", "11", "f4", "22", "11", "f5", "11", "f6", "11", "f7", "11", "f8", "f9", "22", "11",
        "fa", "fb", "fc", "22", "11", "fd", "22", "11", "fe", "22", "11", "ff", "33", "22", "11"]
    end
    let(:count) { 256 }

    before do
      mini_asm.instance_variable_set(:@memory, memory)
      mini_asm.instance_variable_set(:@cpu, :wdc65816)
    end

    it 'disassembles correctly' do
      expect(subject).to eq [
        '00/0000: 00 11                 BRK #11',
        '00/0002: 01 11                 ORA (11,X)',
        '00/0004: 02 11                 COP #11',
        '00/0006: 03 11                 ORA 11,S',
        '00/0008: 04 11                 TSB 11',
        '00/000A: 05 11                 ORA 11',
        '00/000C: 06 11                 ASL 11',
        '00/000E: 07 11                 ORA [11]',
        '00/0010: 08                    PHP',
        '00/0011: 09 11                 ORA #11',
        '00/0013: 0a                    ASL',
        '00/0014: 0b                    PHD',
        '00/0015: 0c 22 11              TSB 1122',
        '00/0018: 0d 22 11              ORA 1122',
        '00/001B: 0e 22 11              ASL 1122',
        '00/001E: 0f 33 22 11           ORA 112233',
        '00/0022: 10 11                 BPL 0035 {+11}',
        '00/0024: 11 11                 ORA (11),Y',
        '00/0026: 12 11                 ORA (11)',
        '00/0028: 13 11                 ORA (11,S),Y',
        '00/002A: 14 11                 TRB 11',
        '00/002C: 15 11                 ORA 11,X',
        '00/002E: 16 11                 ASL 11,X',
        '00/0030: 17 11                 ORA [11],Y',
        '00/0032: 18                    CLC',
        '00/0033: 19 22 11              ORA 1122,Y',
        '00/0036: 1a                    INC',
        '00/0037: 1b                    TCS',
        '00/0038: 1c 22 11              TRB 1122',
        '00/003B: 1d 22 11              ORA 1122,X',
        '00/003E: 1e 22 11              ASL 1122,X',
        '00/0041: 1f 33 22 11           ORA 112233,X',
        '00/0045: 20 22 11              JSR 1122',
        '00/0048: 21 11                 AND (11,X)',
        '00/004A: 22 33 22 11           JSL 112233',
        '00/004E: 23 11                 AND 11,S',
        '00/0050: 24 11                 BIT 11',
        '00/0052: 25 11                 AND 11',
        '00/0054: 26 11                 ROL 11',
        '00/0056: 27 11                 AND [11]',
        '00/0058: 28                    PLP',
        '00/0059: 29 11                 AND #11',
        '00/005B: 2a                    ROL',
        '00/005C: 2b                    PLD',
        '00/005D: 2c 22 11              BIT 1122',
        '00/0060: 2d 22 11              AND 1122',
        '00/0063: 2e 22 11              ROL 1122',
        '00/0066: 2f 33 22 11           AND 112233',
        '00/006A: 30 11                 BMI 007D {+11}',
        '00/006C: 31 11                 AND (11),Y',
        '00/006E: 32 11                 AND (11)',
        '00/0070: 33 11                 AND (11,S),Y',
        '00/0072: 34 11                 BIT 11,X',
        '00/0074: 35 11                 AND 11,X',
        '00/0076: 36 11                 ROL 11,X',
        '00/0078: 37 11                 AND [11],Y',
        '00/007A: 38                    SEC',
        '00/007B: 39 22 11              AND 1122,Y',
        '00/007E: 3a                    DEC',
        '00/007F: 3b                    TSC',
        '00/0080: 3c 22 11              BIT 1122,X',
        '00/0083: 3d 22 11              AND 1122,X',
        '00/0086: 3e 22 11              ROL 1122,X',
        '00/0089: 3f 33 22 11           AND 112233,X',
        '00/008D: 40                    RTI',
        '00/008E: 41 11                 EOR (11,X)',
        '00/0090: 42 11                 WDM #11',
        '00/0092: 43 11                 EOR 11,S',
        '00/0094: 44 22 11              MVP 11,22',
        '00/0097: 45 11                 EOR 11',
        '00/0099: 46 11                 LSR 11',
        '00/009B: 47 11                 EOR [11]',
        '00/009D: 48                    PHA',
        '00/009E: 49 11                 EOR #11',
        '00/00A0: 4a                    LSR',
        '00/00A1: 4b                    PHK',
        '00/00A2: 4c 22 11              JMP 1122',
        '00/00A5: 4d 22 11              EOR 1122',
        '00/00A8: 4e 22 11              LSR 1122',
        '00/00AB: 4f 33 22 11           EOR 112233',
        '00/00AF: 50 11                 BVC 00C2 {+11}',
        '00/00B1: 51 11                 EOR (11),Y',
        '00/00B3: 52 11                 EOR (11)',
        '00/00B5: 53 11                 EOR (11,S),Y',
        '00/00B7: 54 22 11              MVN 11,22',
        '00/00BA: 55 11                 EOR 11,X',
        '00/00BC: 56 11                 LSR 11,X',
        '00/00BE: 57 11                 EOR [11],Y',
        '00/00C0: 58                    CLI',
        '00/00C1: 59 22 11              EOR 1122,Y',
        '00/00C4: 5a                    PHY',
        '00/00C5: 5b                    TCD',
        '00/00C6: 5c 33 22 11           JMP 112233',
        '00/00CA: 5d 22 11              EOR 1122,X',
        '00/00CD: 5e 22 11              LSR 1122,X',
        '00/00D0: 5f 33 22 11           EOR 112233,X',
        '00/00D4: 60                    RTS',
        '00/00D5: 61 11                 ADC (11,X)',
        '00/00D7: 62 22 11              PER 11FC {+1122}',
        '00/00DA: 63 11                 ADC 11,S',
        '00/00DC: 64 11                 STZ 11',
        '00/00DE: 65 11                 ADC 11',
        '00/00E0: 66 11                 ROR 11',
        '00/00E2: 67 11                 ADC [11]',
        '00/00E4: 68                    PLA',
        '00/00E5: 69 11                 ADC #11',
        '00/00E7: 6a                    ROR',
        '00/00E8: 6b                    RTL',
        '00/00E9: 6c 22 11              JMP (1122)',
        '00/00EC: 6d 22 11              ADC 1122',
        '00/00EF: 6e 22 11              ROR 1122',
        '00/00F2: 6f 33 22 11           ADC 112233',
        '00/00F6: 70 11                 BVS 0109 {+11}',
        '00/00F8: 71 11                 ADC (11),Y',
        '00/00FA: 72 11                 ADC (11)',
        '00/00FC: 73 11                 ADC (11,S),Y',
        '00/00FE: 74 11                 STZ 11,X',
        '00/0100: 75 11                 ADC 11,X',
        '00/0102: 76 11                 ROR 11,X',
        '00/0104: 77 11                 ADC [11],Y',
        '00/0106: 78                    SEI',
        '00/0107: 79 22 11              ADC 1122,Y',
        '00/010A: 7a                    PLY',
        '00/010B: 7b                    TDC',
        '00/010C: 7c 22 11              JMP (1122,X)',
        '00/010F: 7d 22 11              ADC 1122,X',
        '00/0112: 7e 22 11              ROR 1122,X',
        '00/0115: 7f 33 22 11           ADC 112233,X',
        '00/0119: 80 11                 BRA 012C {+11}',
        '00/011B: 81 11                 STA (11,X)',
        '00/011D: 82 22 11              BRL 1242 {+1122}',
        '00/0120: 83 11                 STA 11,S',
        '00/0122: 84 11                 STY 11',
        '00/0124: 85 11                 STA 11',
        '00/0126: 86 11                 STX 11',
        '00/0128: 87 11                 STA [11]',
        '00/012A: 88                    DEY',
        '00/012B: 89 11                 BIT #11',
        '00/012D: 8a                    TXA',
        '00/012E: 8b                    PHB',
        '00/012F: 8c 22 11              STY 1122',
        '00/0132: 8d 22 11              STA 1122',
        '00/0135: 8e 22 11              STX 1122',
        '00/0138: 8f 33 22 11           STA 112233',
        '00/013C: 90 11                 BCC 014F {+11}',
        '00/013E: 91 11                 STA (11),Y',
        '00/0140: 92 11                 STA (11)',
        '00/0142: 93 11                 STA (11,S),Y',
        '00/0144: 94 11                 STY 11,X',
        '00/0146: 95 11                 STA 11,X',
        '00/0148: 96 11                 STX 11,Y',
        '00/014A: 97 11                 STA [11],Y',
        '00/014C: 98                    TYA',
        '00/014D: 99 22 11              STA 1122,Y',
        '00/0150: 9a                    TXS',
        '00/0151: 9b                    TXY',
        '00/0152: 9c 22 11              STZ 1122',
        '00/0155: 9d 22 11              STA 1122,X',
        '00/0158: 9e 22 11              STZ 1122,X',
        '00/015B: 9f 33 22 11           STA 112233,X',
        '00/015F: a0 11                 LDY #11',
        '00/0161: a1 11                 LDA (11,X)',
        '00/0163: a2 11                 LDX #11',
        '00/0165: a3 11                 LDA 11,S',
        '00/0167: a4 11                 LDY 11',
        '00/0169: a5 11                 LDA 11',
        '00/016B: a6 11                 LDX 11',
        '00/016D: a7 11                 LDA [11]',
        '00/016F: a8                    TAY',
        '00/0170: a9 11                 LDA #11',
        '00/0172: aa                    TAX',
        '00/0173: ab                    PLB',
        '00/0174: ac 22 11              LDY 1122',
        '00/0177: ad 22 11              LDA 1122',
        '00/017A: ae 22 11              LDX 1122',
        '00/017D: af 33 22 11           LDA 112233',
        '00/0181: b0 11                 BCS 0194 {+11}',
        '00/0183: b1 11                 LDA (11),Y',
        '00/0185: b2 11                 LDA (11)',
        '00/0187: b3 11                 LDA (11,S),Y',
        '00/0189: b4 11                 LDY 11,X',
        '00/018B: b5 11                 LDA 11,X',
        '00/018D: b6 11                 LDX 11,Y',
        '00/018F: b7 11                 LDA [11],Y',
        '00/0191: b8                    CLV',
        '00/0192: b9 22 11              LDA 1122,Y',
        '00/0195: ba                    TSX',
        '00/0196: bb                    TYX',
        '00/0197: bc 22 11              LDY 1122,X',
        '00/019A: bd 22 11              LDA 1122,X',
        '00/019D: be 22 11              LDX 1122,Y',
        '00/01A0: bf 33 22 11           LDA 112233,X',
        '00/01A4: c0 11                 CPY #11',
        '00/01A6: c1 11                 CMP (11,X)',
        '00/01A8: c2 00                 REP #00',
        '00/01AA: c3 11                 CMP 11,S',
        '00/01AC: c4 11                 CPY 11',
        '00/01AE: c5 11                 CMP 11',
        '00/01B0: c6 11                 DEC 11',
        '00/01B2: c7 11                 CMP [11]',
        '00/01B4: c8                    INY',
        '00/01B5: c9 11                 CMP #11',
        '00/01B7: ca                    DEX',
        '00/01B8: cb                    WAI',
        '00/01B9: cc 22 11              CPY 1122',
        '00/01BC: cd 22 11              CMP 1122',
        '00/01BF: ce 22 11              DEC 1122',
        '00/01C2: cf 33 22 11           CMP 112233',
        '00/01C6: d0 11                 BNE 01D9 {+11}',
        '00/01C8: d1 11                 CMP (11),Y',
        '00/01CA: d2 11                 CMP (11)',
        '00/01CC: d3 11                 CMP (11,S),Y',
        '00/01CE: d4 11                 PEI 11',
        '00/01D0: d5 11                 CMP 11,X',
        '00/01D2: d6 11                 DEC 11,X',
        '00/01D4: d7 11                 CMP [11],Y',
        '00/01D6: d8                    CLD',
        '00/01D7: d9 22 11              CMP 1122,Y',
        '00/01DA: da                    PHX',
        '00/01DB: db                    STP',
        '00/01DC: dc 22 11              JMP [1122]',
        '00/01DF: dd 22 11              CMP 1122,X',
        '00/01E2: de 22 11              DEC 1122,X',
        '00/01E5: df 33 22 11           CMP 112233,X',
        '00/01E9: e0 11                 CPX #11',
        '00/01EB: e1 11                 SBC (11,X)',
        '00/01ED: e2 00                 SEP #00',
        '00/01EF: e3 11                 SBC 11,S',
        '00/01F1: e4 11                 CPX 11',
        '00/01F3: e5 11                 SBC 11',
        '00/01F5: e6 11                 INC 11',
        '00/01F7: e7 11                 SBC [11]',
        '00/01F9: e8                    INX',
        '00/01FA: e9 11                 SBC #11',
        '00/01FC: ea                    NOP',
        '00/01FD: eb                    XBA',
        '00/01FE: ec 22 11              CPX 1122',
        '00/0201: ed 22 11              SBC 1122',
        '00/0204: ee 22 11              INC 1122',
        '00/0207: ef 33 22 11           SBC 112233',
        '00/020B: f0 11                 BEQ 021E {+11}',
        '00/020D: f1 11                 SBC (11),Y',
        '00/020F: f2 11                 SBC (11)',
        '00/0211: f3 11                 SBC (11,S),Y',
        '00/0213: f4 22 11              PEA 1122',
        '00/0216: f5 11                 SBC 11,X',
        '00/0218: f6 11                 INC 11,X',
        '00/021A: f7 11                 SBC [11],Y',
        '00/021C: f8                    SED',
        '00/021D: f9 22 11              SBC 1122,Y',
        '00/0220: fa                    PLX',
        '00/0221: fb                    XCE',
        '00/0222: fc 22 11              JSR (1122,X)',
        '00/0225: fd 22 11              SBC 1122,X',
        '00/0228: fe 22 11              INC 1122,X',
        '00/022B: ff 33 22 11           SBC 112233,X'
      ]
    end
  end
end